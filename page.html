<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Blockchain Tools</title>
        <link rel="stylesheet" href="style.css">
        <script src="defi1.js"></script>
    </head>
    <body>
        <section id="title">
            <h1>Blockchain Tools</h1>
        </section>
        <section id="converter">
            <h2>Unit converter</h2>
            <form id="convertform" onsubmit="return convert()">
                <input id="inputValue" name="inputValue">
                <select id="conversionFunction" name="conversionFunction">
                    <option value="" selected>Select a conversion</option>
                    <option value="convertHexaToDeci">Hexadecimal to decimal</option>
                    <option value="convertDeciToHexa">Decimal to hexadecimal</option>
                    <option value="convertHexaLittleEndianToHexa">Hexadecimal little endian to hexadecimal</option>
                    <option value="convertVarIntToDeci">VarInt to decimal</option>
                    <option value="convertDeciToVarInt">Decimal to varInt</option>
                    <option value="convertBitsToTarget">Bits to Target</option>
                    <option value="convertTargetToDifficulty">Target to Difficulty</option>
                    <option value="convertTargetToPDifficulty">Target to Difficulty (pool)</option>
                </select>
                <input type="submit" value="Convert"/>
            </form>
            <input id="convertedNumber" name="convertedNumber">
        </section>
        <section id="blockInfo">
            <h2>Block displayer</h2>
            <input id="file" type="file">
            <button id="read" onclick="readJson()">Read Json file</button>
            <div id="blockDetails"></div>
        </section>
        
        <script type="text/javascript">
            function convert() {
                let inputValue = document.getElementById("inputValue").value
                let selected = document.getElementById("conversionFunction").value
                let convertedValue = ""
                switch (selected) {
                    case "convertHexaToDeci":
                        convertedValue = convertHexaToDeci(inputValue)
                    break;
                    case "convertDeciToHexa":
                        convertedValue = convertDeciToHexa(inputValue)
                    break;
                    case "convertHexaLittleEndianToHexa":
                        convertedValue = convertHexaLittleEndianToHexa(inputValue)
                    break;
                    case "convertVarIntToDeci":
                        convertedValue = convertVarIntToDeci(inputValue)
                    break;
                    case "convertDeciToVarInt":
                        convertedValue = convertDeciToVarInt(inputValue)
                    break;
                    case "convertBitsToTarget":
                        convertedValue = convertBitsToTarget(inputValue)
                    break;
                    case "convertTargetToDifficulty":
                        convertedValue = convertTargetToDifficulty(inputValue)
                    break;
                    case "convertTargetToPDifficulty":
                        convertedValue = convertTargetToPDifficulty(inputValue)
                    break;
                    default:
                        convertedValue = "Select a conversion type"
                }
                document.getElementById("convertedNumber").value = convertedValue
                return false
            }

            // Check for the various File API support.
            function readJson(){
                if (window.File && window.FileReader && window.FileList) {
                    // Great success! All the File APIs are supported.
                    console.log("File APIs Supported")
                } else {
                    alert('The File APIs are not fully supported in this browser.');
                }
            }

            //Parse uploaded file as a text
            let fileInput = document.querySelector('#file');
            fileInput.addEventListener('change', function() {
                let reader = new FileReader();
                reader.addEventListener('load', function() {
                    let infos = reader.result
                    console.log(typeof(infos))
                    console.log(infos)
                    let obj = JSON.parse(infos)
                    //let obj2 = JSON.stringify(infos,null,4)
                    //obj2 = JSON.stringify(obj,null,4)
                    let objInfos = ""
                    $.each(obj, function(i){
                        if (typeof(i) == "string") {
                            objInfos += (i + ": " + obj[i].toString() + "<br/>");
                        } else {
                            $.each(i, function(j){
                                objInfos += (j + ": " + obj[j].toString() + "<br/>");
                            })
                        }  
                    });
                    document.getElementById("blockDetails").innerHTML = objInfos
                });
                reader.readAsText(fileInput.files[0], 'UTF-8');
            });
        </script>
    </body>
</html>